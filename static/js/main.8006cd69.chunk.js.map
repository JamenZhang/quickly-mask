{"version":3,"sources":["img/test.jpg","img/example.jpg","api/face.js","components/draw-box.js","components/show-descriptors.js","common/profile.js","pages/face-recognition.js","pages/camera-face-detect.js","utils/utils.js","utils/drawing.js","pages/christmas-hat/index.js","pages/home.js","components/header.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","SSD_MOBILENETV1","TINY_FACE_DETECTOR","selectedFaceDetector","minConfidence","inputSize","scoreThreshold","maxDescriptorDistance","loadModels","_loadModels","apply","this","arguments","_callee","MODEL_URL","regenerator_default","a","wrap","_context","prev","next","process","faceapi","ssdMobilenetv1","tinyFaceDetector","load","stop","getFullFaceDescription","_x","_getFullFaceDescription","_callee2","blob","OPTION","img","fullDesc","_args2","_context2","length","undefined","sent","withFaceLandmarks","withFaceDescriptors","abrupt","createMatcher","_x2","_createMatcher","_callee3","faceProfile","members","labeledDescriptors","faceMatcher","_context3","Object","keys","map","member","name","descriptors","descriptor","Float32Array","isFaceDetectionModelLoaded","params","DrawBox","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","getDescription","asyncToGenerator","mark","match","_args","setState","fd","detections","detection","state","findBestMatch","newProps","_this$props","imageWidth","boxColor","_this$state","box","i","relativeBox","dimension","_imageDims","_X","_Y","_y","_height","_width","_W","width","_H","height","react_default","createElement","key","style","position","border","borderColor","transform","concat","_label","backgroundColor","marginTop","color","Component","ShowDescriptors","update","display","flexDirection","alignContent","alignItems","padding","margin","wordBreak","borderStyle","toString","JSON_PROFILE","require","testImg","INIT_STATE","url","imageURL","imageDimension","error","loading","FaceRecognition","mounting","matcher","getImageDimension","handleImageChange","handleFileChange","_ref3","event","resetState","URL","createObjectURL","target","files","handleURLChange","value","handleButtonClick","_callee4","_context4","fetch","then","r","catch","type","includes","_callee5","image","_args5","_context5","Image","onload","HEIGHT","WIDTH","src","handleDescriptorsCheck","showDescriptors","checked","objectSpread","isModelLoaded","document","documentElement","clientWidth","status","spinner","top","left","textShadow","className","alt","draw_box","id","onChange","accept","placeholder","pattern","size","onClick","show_descriptors","withRouter","CameraFaceDetect","setInputDevice","navigator","mediaDevices","enumerateDevices","_ref","devices","filter","device","kind","facingMode","exact","startCapture","interval","setInterval","capture","webcam","current","getScreenshot","React","createRef","clearInterval","videoConstraints","camera","react_webcam_default","audio","ref","screenshotFormat","getMedian","points","Math","floor","getDistance","b","sqrt","pow","x","y","getMidPointOfEye","leftPoints","rightPoints","pa","pb","getJawPos","jawPoints","getFaceLength","jawPos","midPointOfEyebrows","getFaceWith","outlinePoints","getFaceRadian","PI","atan2","getHeadPos","midPos","k","d","point","getPos","getK","getHatInfo","results","landmarks","rightEyeBrowPoints","getRightEyeBrow","leftEyeBrowPoints","angle","headPos","faceLength","faceWidth","getFaceInfo","getLeftEyeBrow","getJawOutline","translateHat","picSize","getImg","callback","setAttribute","drawHat","ctx","config","save","console","log","translate","rotate","_translateHat","drawImage","restore","drawing","canvas","options","info","_options$width","_options$height","_options$imgSrc","imgSrc","getContext","clearRect","len","ChristmasHat","_ref2","_args3","canvasRef","imageRef","resizedResults","drawFaceLandmarks","_resizedResults$0$det","_this2","exampleImage","Home","borderRadius","href","textAlign","marginLeft","Header","Link","to","App","Router","history","createBrowserHistory","basename","header","Route","path","component","Boolean","window","location","hostname","ReactDOM","render","src_App_0","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.8006cd69.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/test.34e86f06.jpg\";","module.exports = __webpack_public_path__ + \"static/media/example.cc46e63d.jpg\";","import * as faceapi from 'face-api.js';\n\nconst SSD_MOBILENETV1 = 'ssd_mobilenetv1';\nconst TINY_FACE_DETECTOR = 'tiny_face_detector';\n\nlet selectedFaceDetector = SSD_MOBILENETV1;\n\n// ssd_mobilenetv1 options\nlet minConfidence = 0.5;\n\n// tiny_face_detector options\nlet inputSize = 512;\nlet scoreThreshold = 0.5;\n\n\nconst maxDescriptorDistance = 0.5;\n\nfunction getFaceDetectorOptions() {\n  return selectedFaceDetector === SSD_MOBILENETV1\n    ? new faceapi.SsdMobilenetv1Options({ minConfidence })\n    : new faceapi.TinyFaceDetectorOptions({ inputSize, scoreThreshold });\n}\n\nfunction getCurrentFaceDetectionNet() {\n  if (selectedFaceDetector === SSD_MOBILENETV1) {\n    return faceapi.nets.ssdMobilenetv1;\n  }\n  if (selectedFaceDetector === TINY_FACE_DETECTOR) {\n    return faceapi.nets.tinyFaceDetector;\n  }\n}\n\nexport async function loadModels() {\n  const MODEL_URL = process.env.PUBLIC_URL + '/models';\n  // await faceapi.loadTinyFaceDetectorModel(MODEL_URL);\n  // await faceapi.loadFaceLandmarkTinyModel(MODEL_URL);\n  await getCurrentFaceDetectionNet().load(MODEL_URL)\n  await faceapi.loadFaceRecognitionModel(MODEL_URL);\n  await faceapi.loadSsdMobilenetv1Model(MODEL_URL)\n  await faceapi.loadFaceLandmarkModel(MODEL_URL)\n}\n\nexport async function getFullFaceDescription(blob, inputSize = 512) {\n  const OPTION = getFaceDetectorOptions()\n\n  // fetch image to api\n  let img = await faceapi.fetchImage(blob);\n\n  // detect all faces and generate full description from image\n  // including landmark and descriptor of each face\n  let fullDesc = await faceapi\n    .detectAllFaces(img, OPTION)\n    .withFaceLandmarks()\n    .withFaceDescriptors();\n  // const resizedResults = await faceapi.resizeResults(fullDesc, img);\n  return fullDesc;\n}\n\n\n\nexport async function createMatcher(faceProfile) {\n  // Create labeled descriptors of member from profile\n  let members = Object.keys(faceProfile);\n  let labeledDescriptors = members.map(\n    member =>\n      new faceapi.LabeledFaceDescriptors(\n        faceProfile[member].name,\n        faceProfile[member].descriptors.map(\n          descriptor => new Float32Array(descriptor)\n        )\n      )\n  );\n\n  // Create face matcher (maximum descriptor distance is 0.5)\n  let faceMatcher = new faceapi.FaceMatcher(\n    labeledDescriptors,\n    maxDescriptorDistance\n  );\n  return faceMatcher;\n}\n\nexport function isFaceDetectionModelLoaded() {\n  return !!faceapi.nets.tinyFaceDetector.params;\n}\n","import React, { Component } from 'react';\n\nclass DrawBox extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      descriptors: null,\n      detections: null,\n      match: null\n    };\n  }\n\n  componentDidMount() {\n    this.getDescription();\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    this.getDescription(newProps);\n  }\n\n  getDescription = async (props = this.props) => {\n    const { fullDesc, faceMatcher } = props;\n    if (!!fullDesc) {\n      await this.setState({\n        descriptors: fullDesc.map(fd => fd.descriptor),\n        detections: fullDesc.map(fd => fd.detection)\n      });\n      if (!!this.state.descriptors && !!faceMatcher) {\n        let match = await this.state.descriptors.map(descriptor =>\n          faceMatcher.findBestMatch(descriptor)\n        );\n        this.setState({ match });\n      }\n    }\n  };\n\n  render() {\n    const { imageWidth, boxColor } = this.props;\n    const { detections, match } = this.state;\n    let box = null;\n\n    if (!!detections) {\n      box = detections.map((detection, i) => {\n        const relativeBox = detection.relativeBox;\n        const dimension = detection._imageDims;\n        let _X = imageWidth * relativeBox._x;\n        let _Y =\n          (relativeBox._y * imageWidth * dimension._height) / dimension._width;\n        let _W = imageWidth * relativeBox.width;\n        let _H =\n          (relativeBox.height * imageWidth * dimension._height) /\n          dimension._width;\n        return (\n          <div key={i}>\n            <div\n              style={{\n                position: 'absolute',\n                border: 'solid',\n                borderColor: boxColor,\n                height: _H,\n                width: _W,\n                transform: `translate(${_X}px,${_Y}px)`\n              }}\n            >\n              {!!match && match[i] && match[i]._label !== 'unknown' ? (\n                <p\n                  style={{\n                    backgroundColor: boxColor,\n                    border: 'solid',\n                    borderColor: boxColor,\n                    width: _W,\n                    marginTop: 0,\n                    color: '#fff',\n                    transform: `translate(-3px,${_H}px)`\n                  }}\n                >\n                  {match[i]._label}\n                </p>\n              ) : null}\n            </div>\n          </div>\n        );\n      });\n    }\n\n    return <div>{box}</div>;\n  }\n}\n\nexport default DrawBox;\n","import React, { Component } from 'react';\n\nclass ShowDescriptors extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      descriptors: null\n    };\n  }\n\n  componentDidMount() {\n    this.update();\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    this.update(newProps);\n  }\n\n  update = (props = this.props) => {\n    let { fullDesc } = props;\n    if (!!fullDesc) {\n      this.setState({\n        descriptors: fullDesc.map(fd => fd.descriptor)\n      });\n    }\n  };\n\n  render() {\n    const { descriptors } = this.state;\n\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignContent: 'center',\n          alignItems: 'center'\n        }}\n      >\n        <h3>Detail Descriptions</h3>\n        {!!descriptors\n          ? descriptors.map((descriptor, i) => (\n              <p\n                key={i}\n                style={{\n                  padding: 10,\n                  margin: 20,\n                  wordBreak: 'break-all',\n                  borderStyle: 'solid',\n                  borderColor: 'blue'\n                }}\n              >\n                <strong>Descriptor_{i}: </strong>\n                {descriptor.toString()}\n              </p>\n            ))\n          : null}\n      </div>\n    );\n  }\n}\n\nexport default ShowDescriptors;\n","// Descriptors profile\nexport const JSON_PROFILE = require('../descriptors/bnk48.json');\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport {\n  loadModels,\n  getFullFaceDescription,\n  createMatcher,\n  isFaceDetectionModelLoaded\n} from '../api/face';\nimport DrawBox from '../components/draw-box';\nimport ShowDescriptors from '../components/show-descriptors';\nimport { JSON_PROFILE } from '../common/profile';\n\nconst MaxWidth = 600;\nconst boxColor = '#BE80B5';\nconst testImg = require('../img/test.jpg');\n\nconst INIT_STATE = {\n  url: null,\n  imageURL: null,\n  fullDesc: null,\n  imageDimension: null,\n  error: null,\n  loading: false\n};\n\nclass FaceRecognition extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ...INIT_STATE,\n      faceMatcher: null,\n      showDescriptors: false,\n      WIDTH: null,\n      HEIGHT: 0,\n      isModelLoaded: !!isFaceDetectionModelLoaded()\n    };\n  }\n\n  componentDidMount() {\n    this.resetState();\n    let _W = document.documentElement.clientWidth;\n    if (_W > MaxWidth) _W = MaxWidth;\n    this.setState({ WIDTH: _W });\n    this.mounting();\n  }\n\n  mounting = async () => {\n    await loadModels();\n    await this.matcher();\n    await this.getImageDimension(testImg);\n    await this.setState({ imageURL: testImg, loading: true });\n    await this.handleImageChange(testImg);\n  };\n\n  matcher = async () => {\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    this.setState({ faceMatcher });\n  };\n\n  handleFileChange = async event => {\n    this.resetState();\n    await this.setState({\n      imageURL: URL.createObjectURL(event.target.files[0]),\n      loading: true\n    });\n    this.handleImageChange();\n  };\n\n  handleURLChange = event => {\n    this.setState({ url: event.target.value });\n  };\n\n  handleButtonClick = async () => {\n    this.resetState();\n    let blob = await fetch(this.state.url)\n      .then(r => r.blob())\n      .catch(error => this.setState({ error }));\n    if (!!blob && blob.type.includes('image')) {\n      this.setState({\n        imageURL: URL.createObjectURL(blob),\n        loading: true\n      });\n      this.handleImageChange();\n    }\n  };\n\n  handleImageChange = async (image = this.state.imageURL) => {\n    await this.getImageDimension(image);\n    await getFullFaceDescription(image).then(fullDesc => {\n      this.setState({ fullDesc, loading: false });\n    });\n  };\n\n  getImageDimension = imageURL => {\n    let img = new Image();\n    img.onload = () => {\n      let HEIGHT = (this.state.WIDTH * img.height) / img.width;\n      this.setState({\n        HEIGHT,\n        imageDimension: {\n          width: img.width,\n          height: img.height\n        }\n      });\n    };\n    img.src = imageURL;\n  };\n\n  handleDescriptorsCheck = event => {\n    this.setState({ showDescriptors: event.target.checked });\n  };\n\n  resetState = () => {\n    this.setState({ ...INIT_STATE });\n  };\n  render() {\n    const {\n      WIDTH,\n      HEIGHT,\n      imageURL,\n      fullDesc,\n      faceMatcher,\n      showDescriptors,\n      isModelLoaded,\n      error,\n      loading\n    } = this.state;\n\n    // Display working status\n    let status = <p>Status: Model Loaded = {isModelLoaded.toString()}</p>;\n    if (!!error && error.toString() === 'TypeError: Failed to fetch') {\n      status = (\n        <p style={{ color: 'red' }}>Status: Error Failed to fetch Image URL</p>\n      );\n    } else if (loading) {\n      status = <p style={{ color: 'blue' }}>Status: LOADING...</p>;\n    } else if (!!fullDesc && !!imageURL && !loading) {\n      if (fullDesc.length < 2)\n        status = <p>Status: {fullDesc.length} Face Detect</p>;\n      if (fullDesc.length > 1)\n        status = <p>Status: {fullDesc.length} Faces Detect</p>;\n    }\n\n    // Loading Spinner\n    let spinner = (\n      <div\n        style={{\n          margin: 0,\n          color: '#BE80B5',\n          position: 'absolute',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%,-50%)',\n          textShadow: '2px 2px 3px #fff'\n        }}\n      >\n        <div className=\"loading\" />\n        <h3>Processing...</h3>\n      </div>\n    );\n\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        }}\n      >\n        {status}\n        <div\n          style={{\n            position: 'relative',\n            width: WIDTH,\n            height: HEIGHT\n          }}\n        >\n          {!!imageURL ? (\n            <div\n              style={{\n                position: 'relative'\n              }}\n            >\n              <div style={{ position: 'absolute' }}>\n                <img style={{ width: WIDTH }} src={imageURL} alt=\"imageURL\" />\n              </div>\n              {!!fullDesc ? (\n                <DrawBox\n                  fullDesc={fullDesc}\n                  faceMatcher={faceMatcher}\n                  imageWidth={WIDTH}\n                  boxColor={boxColor}\n                />\n              ) : null}\n            </div>\n          ) : null}\n          {loading ? spinner : null}\n        </div>\n        <div\n          style={{\n            width: WIDTH,\n            padding: 10,\n            border: 'solid',\n            marginTop: 10\n          }}\n        >\n          <p>Input Image file or URL</p>\n          <input\n            id=\"myFileUpload\"\n            type=\"file\"\n            onChange={this.handleFileChange}\n            accept=\".jpg, .jpeg, .png\"\n          />\n          <br />\n          <div className=\"URLInput\">\n            <input\n              type=\"url\"\n              name=\"url\"\n              id=\"url\"\n              placeholder=\"Place your photo URL here (only .jpg, .jpeg, .png)\"\n              pattern=\"https://.*\"\n              size=\"30\"\n              onChange={this.handleURLChange}\n            />\n            <button onClick={this.handleButtonClick}>Upload</button>\n          </div>\n          <div>\n            <input\n              name=\"descriptors\"\n              type=\"checkbox\"\n              checked={this.state.showDescriptors}\n              onChange={this.handleDescriptorsCheck}\n            />\n            <label>Show Descriptors</label>\n          </div>\n          {!!showDescriptors ? <ShowDescriptors fullDesc={fullDesc} /> : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(FaceRecognition);\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport Webcam from 'react-webcam';\nimport { loadModels, getFullFaceDescription, createMatcher } from '../api/face';\nimport DrawBox from '../components/draw-box';\nimport { JSON_PROFILE } from '../common/profile';\n\nconst WIDTH = 420;\nconst HEIGHT = 420;\nconst inputSize = 160;\n\nclass CameraFaceDetect extends Component {\n  constructor(props) {\n    super(props);\n    this.webcam = React.createRef();\n    this.state = {\n      fullDesc: null,\n      faceMatcher: null,\n      facingMode: null\n    };\n  }\n\n  componentDidMount() {\n    loadModels();\n    this.setInputDevice();\n    this.matcher();\n  }\n\n  setInputDevice = () => {\n    navigator.mediaDevices.enumerateDevices().then(async devices => {\n      let inputDevice = await devices.filter(\n        device => device.kind === 'videoinput'\n      );\n      if (inputDevice.length < 2) {\n        await this.setState({\n          facingMode: 'user'\n        });\n      } else {\n        await this.setState({\n          facingMode: { exact: 'environment' }\n        });\n      }\n      this.startCapture();\n    });\n  };\n\n  matcher = async () => {\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    this.setState({ faceMatcher });\n  };\n\n  startCapture = () => {\n    this.interval = setInterval(() => {\n      this.capture();\n    }, 1500);\n  };\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  capture = async () => {\n    if (!!this.webcam.current) {\n      await getFullFaceDescription(\n        this.webcam.current.getScreenshot(),\n        inputSize\n      ).then(fullDesc => this.setState({ fullDesc }));\n    }\n  };\n\n  render() {\n    const { fullDesc, faceMatcher, facingMode } = this.state;\n    let videoConstraints = null;\n    let camera = '';\n    if (!!facingMode) {\n      videoConstraints = {\n        width: WIDTH,\n        height: HEIGHT,\n        facingMode: facingMode\n      };\n      if (facingMode === 'user') {\n        camera = 'Front';\n      } else {\n        camera = 'Back';\n      }\n    }\n\n    return (\n      <div\n        className=\"Camera\"\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        }}\n      >\n        <p>Camera: {camera}</p>\n        <div\n          style={{\n            width: WIDTH,\n            height: HEIGHT\n          }}\n        >\n          <div style={{ position: 'relative', width: WIDTH }}>\n            {!!videoConstraints ? (\n              <div style={{ position: 'absolute' }}>\n                <Webcam\n                  audio={false}\n                  width={WIDTH}\n                  height={HEIGHT}\n                  ref={this.webcam}\n                  screenshotFormat=\"image/jpeg\"\n                  videoConstraints={videoConstraints}\n                />\n              </div>\n            ) : null}\n            {!!fullDesc ? (\n              <DrawBox\n                fullDesc={fullDesc}\n                faceMatcher={faceMatcher}\n                imageWidth={WIDTH}\n                boxColor={'blue'}\n              />\n            ) : null}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(CameraFaceDetect);\n","/**\n * 获取中间的点\n * @param {*} points\n */\nconst getMedian = points => points[Math.floor(points.length / 2)];\n\n/**\n * 获取两点之间的中点\n * @param {*} pa\n * @param {*} pb\n */\nconst getMidPoint = (pa, pb) => ({\n  x: (pa.x + pb.x) / 2,\n  y: (pa.y + pb.y) / 2,\n});\n\n/**\n * 获取两点之间距离\n * @param {*} a\n * @param {*} b\n */\nconst getDistance = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n\n/**\n * 获取两个眉毛中点\n * @param {*} leftPoints\n * @param {*} rightPoints\n */\nconst getMidPointOfEye = (leftPoints, rightPoints) =>\n  getMidPoint(getMedian(leftPoints), getMedian(rightPoints));\n\n/**\n * 获取下颌的最低点\n * @param {*} jawPoints\n */\nconst getJawPos = jawPoints => getMedian(jawPoints);\n\n/**\n * 获取脸的长度\b （按照三停五眼）\n * @param {*} jawPos\n * @param {*} midPointOfEyebrows\n */\nconst getFaceLength = (jawPos, midPointOfEyebrows) => (5 * getDistance(jawPos, midPointOfEyebrows)) / 3;\n\n/**\n * 获取脸的宽度（即帽子宽度）\n * @param {*} outlinePoints\n */\nconst getFaceWith = outlinePoints => getDistance(outlinePoints[0], outlinePoints[outlinePoints.length - 1])\n\n/**\n * 获取脸的倾斜弧度\n * @param {*} jawPos\n * @param {*} midPointOfEyebrows\n */\nconst getFaceRadian = (jawPos, midPointOfEyebrows) =>\n  Math.PI - Math.atan2(jawPos.x - midPointOfEyebrows.x, jawPos.y - midPointOfEyebrows.y); //弧度  0.9272952180016122\n\n// 计算帽子的位置, \b眉心和右上角顶点的中点（考虑到图片绘制是从左上角开始绘制，还需要根据图片中心做个变换）\n// 知道眉心坐标（x1,y1) 知道下颌的坐标(x2, y2)，知道脸宽w，知道脸长l\n/**\n * 已知K，d, 点，求另一个点\n * @param {*} k\n * @param {*} d\n * @param {*} point\n */\nconst getPos = (k, d, point) => {\n  // 取y变小的那一边\n  let y = -Math.sqrt((d * d) / (1 + k * k)) + point.y;\n  let x = k * (y - point.y) + point.x;\n  return { x, y };\n};\n\n/**\n * 获取头顶的坐标\n * @param {*} midPos 眉心点坐标\n * @param {*} jawPos 下巴底点坐标\n */\nconst getHeadPos = (midPos, jawPos) => {\n  // 获取线的k值\n  const k = getK(midPos, jawPos);\n  // 获取眉心到下颌的距离\n  const distanceOfEye2Jaw = getDistance(midPos, jawPos);\n  return getPos(k, distanceOfEye2Jaw / 2, midPos);\n};\n\n/**\n * 获取K值\n * @param {*} a\n * @param {*} b\n */\nconst getK = (a, b) => (a.x - b.x) / (a.y - b.y);\n\nexport function getHatInfo(results) {\n  function getFaceInfo(leftEyeBrowPoints, rightEyeBrowPoints, outlinePoints) {\n    // 获取眉心的点\n    const midPointOfEyebrows = getMidPointOfEye(leftEyeBrowPoints, rightEyeBrowPoints);\n    // 获取下颌的点\n    const jawPos = getJawPos(outlinePoints);\n    // 获取脸的倾斜角度\n    const angle = getFaceRadian(midPointOfEyebrows, jawPos);\n    // 获取头顶的坐标\n    const headPos = getHeadPos(midPointOfEyebrows, jawPos);\n    // 获取脸大小信息\n    const faceLength = getFaceLength(getJawPos(outlinePoints), midPointOfEyebrows);\n    const faceWidth = getFaceWith(outlinePoints);\n    return {\n      midPointOfEyebrows,\n      jawPos,\n      headPos,\n      angle,\n      faceWidth,\n      faceLength,\n    };\n  }\n  return results.map(({landmarks}) => {\n    const rightEyeBrowPoints = landmarks.getRightEyeBrow();\n    const leftEyeBrowPoints = landmarks.getLeftEyeBrow();\n    const outlinePoints = landmarks.getJawOutline();\n    return getFaceInfo(leftEyeBrowPoints, rightEyeBrowPoints, outlinePoints);\n  });\n}\n","/**\n * 根据我当前的圣诞帽元素进行一些偏移(我的图片大小是200*130)， 圣诞帽可佩戴部分的中心 (62,60)  这里需要微调\n * 图片可佩戴部分是 0.6 倍图片宽度\n * @param {*} x\n * @param {*} y\n */\nconst translateHat = (faceWidth, x, y) => {\n  const picSize = { width: faceWidth / 0.6, height: (faceWidth * 0.65) / 0.6 };\n  return {\n    ...picSize,\n    x: x - (62 * picSize.width) / 200,\n    y: y - (60 * picSize.height) / 130,\n  };\n};\n\n/**\n * 获取图片\n * @param {*} src 图片地址\n * @param {*} callback\n */\nfunction getImg(src, callback) {\n  const img = new Image();\n  img.setAttribute('crossOrigin', 'anonymous');\n  img.src = src;\n  img.onload = () => callback(img);\n}\n\n/**\n * 绘制帽子\n * @param {*} ctx 画布实例\n * @param {{}} config 配置\n */\nfunction drawHat(ctx, config) {\n  const { headPos, angle, faceWidth } = config;\n  getImg('images/hat.png', img => {\n    // 保存画布绘制状态\n    ctx.save();\n    console.log('headPos.x, headPos.y :', headPos.x, headPos.y);\n    // 画布原点移动到画帽子的地方\n    ctx.translate(headPos.x, headPos.y);\n    // 旋转画布到特定角度\n    ctx.rotate(angle);\n    // 偏移图片，使帽子中心刚好在原点\n    const { x, y, width, height } = translateHat(faceWidth, 0, 0);\n    // 我的圣诞帽子实际佩戴部分长度只有0.75倍整个图片长度\n    ctx.drawImage(img, x, y, width, height);\n    // 还原画布绘制状态，如偏移\n    ctx.restore();\n  });\n}\n\n/**\n * 绘制主流程\n * @param {*} canvas\n * @param {*} options\n */\nexport function drawing(canvas, options) {\n  const { info, width = 200, height = 200, imgSrc = 'images/default.jpg' } = options;\n  const ctx = canvas.getContext('2d');\n  // 重置\n  console.log('width, height :', width, height, ctx);\n  ctx.clearRect(0, 0, width, height);\n  // 先把图片绘制上去\n  getImg(imgSrc, img => {\n    ctx.drawImage(img, 0, 0, width, height)\n    // // 循环把帽子画到对应的点上\n    for (let i = 0, len = info.length; i < len; i++) {\n      drawHat(ctx, info[i]);\n    }\n  });\n}\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport {\n  loadModels,\n  getFullFaceDescription,\n  isFaceDetectionModelLoaded\n} from '../../api/face';\n\n// import DrawBox from '../../components/draw-box';\nimport ShowDescriptors from '../../components/show-descriptors';\nimport { getHatInfo } from '../../utils/utils'\nimport { drawing } from '../../utils/drawing'\nimport * as faceapi from 'face-api.js';\n\nconst MaxWidth = 600;\n// const boxColor = '#BE80B5';\nconst testImg = require('../../img/test.jpg');\n\nconst INIT_STATE = {\n  url: null,\n  imageURL: null,\n  fullDesc: null,\n  imageDimension: null,\n  error: null,\n  loading: false\n};\n\n\nclass ChristmasHat extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ...INIT_STATE,\n      faceMatcher: null,\n      showDescriptors: false,\n      WIDTH: null,\n      HEIGHT: 0,\n      isModelLoaded: !!isFaceDetectionModelLoaded()\n    };\n  }\n\n  componentDidMount() {\n    this.resetState();\n    let _W = document.documentElement.clientWidth;\n    if (_W > MaxWidth) _W = MaxWidth;\n    this.setState({ WIDTH: _W });\n    this.mounting();\n  }\n\n  mounting = async () => {\n    await loadModels();\n    await this.getImageDimension(testImg);\n    await this.setState({ imageURL: testImg, loading: true });\n    await this.handleImageChange(testImg);\n  };\n\n  resetState = () => {\n    this.setState({ ...INIT_STATE });\n  };\n\n  handleFileChange = async event => {\n    this.resetState();\n    await this.setState({\n      imageURL: URL.createObjectURL(event.target.files[0]),\n      loading: true\n    });\n    this.handleImageChange();\n  };\n\n  handleImageChange = async (image = this.state.imageURL) => {\n    await this.getImageDimension(image);\n    await getFullFaceDescription(image).then(fullDesc => {\n      faceapi.matchDimensions(this.canvasRef, this.imageRef);\n      const resizedResults = faceapi.resizeResults(fullDesc, this.imageRef);\n      const info = getHatInfo(resizedResults);\n      faceapi.draw.drawFaceLandmarks(this.canvasRef, resizedResults)  // 直接画出识别的的特征点\n      const { detection = {} } = resizedResults[0]\n      const { _imageDims } = detection\n\n      drawing(this.canvasRef, {\n        info,\n        imgSrc: image,\n        width: _imageDims.width,\n        height: _imageDims.height,\n      });\n      this.setState({ fullDesc, loading: false }, () => {\n\n      });\n    });\n  };\n\n  getImageDimension = imageURL => {\n    let img = new Image();\n    img.onload = () => {\n      let HEIGHT = (this.state.WIDTH * img.height) / img.width;\n      this.setState({\n        HEIGHT,\n        imageDimension: {\n          width: img.width,\n          height: img.height\n        }\n      });\n    };\n    img.src = imageURL;\n  };\n\n  handleURLChange = event => {\n    this.setState({ url: event.target.value });\n  };\n\n  handleButtonClick = async () => {\n    this.resetState();\n    let blob = await fetch(this.state.url)\n      .then(r => r.blob())\n      .catch(error => this.setState({ error }));\n    if (!!blob && blob.type.includes('image')) {\n      this.setState({\n        imageURL: URL.createObjectURL(blob),\n        loading: true\n      });\n      this.handleImageChange();\n    }\n  };\n\n  render() {\n    const {\n      WIDTH,\n      HEIGHT,\n      imageURL,\n      fullDesc,\n      showDescriptors,\n      isModelLoaded,\n      error,\n      loading\n    } = this.state;\n\n    // Display working status\n    let status = <p>状态：面部识别库加载中 {isModelLoaded.toString()}</p>;\n    if (!!error && error.toString() === 'TypeError: Failed to fetch') {\n      status = (\n        <p style={{ color: 'red' }}>Status: Error Failed to fetch Image URL</p>\n      );\n    } else if (loading) {\n      status = <p style={{ color: 'blue' }}>状态：加载中</p>;\n    } else if (!!fullDesc && !!imageURL && !loading) {\n      if (fullDesc.length > 0) {\n        status = <p>状态: 识别到{fullDesc.length}个人脸</p>;\n      }\n\n    }\n\n    // Loading Spinner\n    let spinner = (\n      <div\n        style={{\n          margin: 0,\n          color: '#BE80B5',\n          position: 'absolute',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%,-50%)',\n          textShadow: '2px 2px 3px #fff'\n        }}\n      >\n        <div className=\"loading\" />\n        <h3>识别中</h3>\n      </div>\n    );\n\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        }}\n      >\n        {status}\n        <div\n          style={{\n            position: 'relative',\n            width: WIDTH,\n            height: HEIGHT\n          }}\n        >\n          {!!imageURL ? (\n            <div\n              style={{\n                position: 'relative'\n              }}\n            >\n              <div style={{ position: 'absolute' }}>\n                <img ref={img => this.imageRef = img} style={{ width: WIDTH, display: loading ? '' : 'none' }} src={imageURL} alt=\"imageURL\" />\n                <canvas ref={canvas => this.canvasRef = canvas} style={{ width: WIDTH, display: loading ? 'none' : '' }}></canvas>\n              </div>\n              {/* {!!fullDesc ? (\n                <DrawBox\n                  fullDesc={fullDesc}\n                  faceMatcher={faceMatcher}\n                  imageWidth={WIDTH}\n                  boxColor={boxColor}\n                />\n              ) : null} */}\n            </div>\n          ) : null}\n          {loading ? spinner : null}\n        </div>\n        <div\n          style={{\n            width: WIDTH,\n            padding: 10,\n            border: 'solid',\n            marginTop: 10\n          }}\n        >\n          <p>请上传图片或输入图片URL</p>\n          <input\n            id=\"myFileUpload\"\n            type=\"file\"\n            onChange={this.handleFileChange}\n            accept=\".jpg, .jpeg, .png\"\n          />\n          <br />\n          <div className=\"URLInput\">\n            <input\n              type=\"url\"\n              name=\"url\"\n              id=\"url\"\n              placeholder=\"Place your photo URL here (only .jpg, .jpeg, .png)\"\n              pattern=\"https://.*\"\n              size=\"30\"\n              onChange={this.handleURLChange}\n            />\n            <button onClick={this.handleButtonClick}>上传</button>\n          </div>\n          {/* <div>\n            <input\n              name=\"descriptors\"\n              type=\"checkbox\"\n              checked={this.state.showDescriptors}\n              onChange={this.handleDescriptorsCheck}\n            />\n            <label>Show Descriptors</label>\n          </div> */}\n          \n          {!!showDescriptors ? <ShowDescriptors fullDesc={fullDesc} /> : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(ChristmasHat);","import React, { Component } from 'react';\n\nconst exampleImage = require('../img/example.jpg');\n\nexport default class Home extends Component {\n  render() {\n    const WIDTH = document.documentElement.clientWidth;\n    return (\n      <div\n        style={{\n          border: 'solid',\n          borderRadius: 8,\n          width: { WIDTH },\n          margin: 10,\n          padding: 5\n        }}\n      >\n        <h2>面部识别APP</h2>\n        <h4>面部识别APP，在Web浏览器上运营，基于 <a href=\"https://github.com/justadudewhohacks/face-api.js\">\n          face-api.js\n          </a>\n        </h4>\n        <img src={exampleImage} alt=\"example\" width=\"350\" />\n\n        <div\n          style={{\n            display: 'flex',\n            flexDirection: 'column',\n            textAlign: 'left',\n            margin: 'auto',\n            marginLeft: 10\n          }}\n        >\n          <h3>如何使用</h3>\n          <p>\n            这个应用可以识别上传的图片，并且分析出是否是泰国 BNK48 组合成员。如果识别出，成员名称将会在面部框中显示出来。\n          </p>\n          <div>\n            <ul>\n              <h4>基本要求：</h4>\n              <li>支持开启了Javascript的PC浏览器，如Chrome, IE,Safari</li>\n              <li>在安卓手机上，支持照片识别和视频摄像头识别</li>\n              <li>在iPhone上，只能在Safari上支持，只能识别图片</li>\n              <li>不支持更老机型，如iPhone 4</li>\n            </ul>\n            <ul>\n              <h4>图片识别</h4>\n              <li>通过上传或者输入Url来设置图片</li>\n              <li>图片必须是jpg、jpeg、png 格式</li>\n              <li>图片Url必须允许跨域请求，否则这个APP将无法获取图片。任何Facebook上的图片在本APP上测试都是良好的。</li>\n              <li>这个APP识图识别所有脸部，如果脸部过多，时间花的越久。</li>\n              <li>如果物体的脸部倾斜，太大或太小和/或脸部模糊，则很难进行脸部检测。</li>\n              <li>如果他们的脸看起来相似，或者对象的脸看起来不直视相机，则该应用可能会错误地识别成员。</li>\n              <li>这个应用程式可能不适用于较旧的智慧型手机或某些浏览器。 （我发现我的Iphone4无法正常处理检测，而iphone7或8工作正常。</li>\n            </ul>\n            <ul>\n              <h4>实时识别</h4>\n              <li>视频输入可与PC网络摄像头或Android手机的摄像头配合使用。</li>\n              <li>目前，此应用程序不支持Iphone相机进行实时检测。</li>\n              <li>应用程序将尝试检测并识别任何面孔，但性能取决于设备的CPU。</li>\n              <li>使用PC网络摄像头进行检测和识别可以很快，而在智能手机上工作则可以慢一些。</li>\n            </ul>\n            <ul>\n              <h4>参考资料</h4>\n              <li>如果想参看源码，也可以看<a href=\"https://github.com/supachaic/bnk48-face-recognition\">原作者的项目</a>\n              </li>\n              <li>这个APP的教程，可以看《<a href=\"https://medium.com/@supachaic/facial-recognition-spa-for-bnk48-idol-group-using-react-and-face-api-js-ad62b43ec5b6\">\n                  Facial Recognition SPA for BNK48 Idol group using React and\n                  face-api.js\n                </a></li>\n              <li>\n                face-api.js API{' '}\n                <a href=\"https://github.com/justadudewhohacks/face-api.js\">\n                  repo\n                </a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\n\nclass Header extends Component {\n  render() {\n    return (\n      <header>\n        <div className=\"Navbar\">\n          <Link to=\"/\">首页</Link>\n          <Link to=\"/christmas-hat\">圣诞帽</Link>\n          <Link to=\"/photo\">图片识别</Link>\n          <Link to=\"/camera\">实时识别</Link>\n        </div>\n      </header>\n    );\n  }\n}\n\nexport default Header;\n","import React, { Component } from 'react';\nimport { Route, Router } from 'react-router-dom';\nimport { createBrowserHistory } from 'history';\nimport FaceRecognition from './pages/face-recognition';\nimport CameraFaceDetect from './pages/camera-face-detect';\nimport ChristmasHat from './pages/christmas-hat';\nimport Home from './pages/home';\nimport Header from './components/header';\nimport './App.css';\n\nclass App extends Component {\n  render() {\n    return (\n      <div className=\"App\">\n        <Router history={createBrowserHistory({ basename: process.env.PUBLIC_URL })}>\n          <div className=\"route\">\n            <Header />\n            <Route exact path=\"/\" component={Home} />\n            <Route exact path=\"/christmas-hat\" component={ChristmasHat} />\n            <Route exact path=\"/photo\" component={FaceRecognition} />\n            <Route exact path=\"/camera\" component={CameraFaceDetect} />\n          </div>\n        </Router>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}